<!-- Wappler include head-page="layouts/admin" fontawesome_5="cdn" bootstrap5="local" is="dmx-app" id="products" appConnect="local" components="{dmxDataTraversal:{},dmxBootstrap5Modal:{},dmxTagify:{},dmxFormatter:{},dmxBootstrap5TableGenerator:{}}" -->
<dmx-serverconnect id="serverconnectCategories" url="/api/products/categories/read"></dmx-serverconnect>
<dmx-data-view id="data_viewCategory" dmx-bind:data="serverconnectCategories.data.queryCategories" filter="(id == searchCategory.value)"></dmx-data-view>
<dmx-serverconnect id="serverconnectProducts" url="/api/products/products/read"></dmx-serverconnect>
<dmx-data-view id="data_viewProducts" dmx-bind:data="serverconnectProducts.data.queryProducts" filter="(category_id == searchCategory.value)"></dmx-data-view>
<dmx-data-detail id="data_detailProduct" dmx-bind:data="data_viewProducts.data" key="id"></dmx-data-detail>
<meta name="ac:route" content="/dashboard/products">
<div class="container-fluid">
    <div class="row">
        <div class="col">
            <h2>Products</h2>
        </div>
    </div>
    <div class="row align-items-end mb-4">
        <div class="col-3">
            <p class="mb-0">Choose a Category</p>
            <input id="searchCategory" name="searchCategory" type="text" class="form-control" is="dmx-tagify" mode="select" dmx-bind:data="serverconnectCategories.data.queryCategories" tag-text="name" tag-value="id" min-chars="0">
        </div>
        <div class="col">
            <button id="btnAddProduct" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalAddProduct" dmx-show="searchCategory.value">Add Product</button>
        </div>
    </div>
    <div class="row" dmx-show="searchCategory.value">
        <div class="col-4">
            <p dmx-hide="data_viewProducts.data.hasItems()">There are no products listed for this category</p>
            <div class="table-responsive">
                <table class="table table-sm" dmx-show="data_viewProducts.data.hasItems()">
                    <thead>
                        <tr>
                            <th>Name</th>
                        </tr>
                    </thead>
                    <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="data_viewProducts.data" id="tableRepeat1">
                        <tr dmx-on:click="data_detailProduct.select(id)" dmx-class:bg-warning="(id == data_detailProduct.data.id)">
                            <td dmx-text="name"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col" dmx-show="data_detailProduct.data">
            <div class="table-responsive">
                <table class="table table-sm">
                    <tbody dmx-generator="bs5table" dmx-populate="data_detailProduct.data">
                        <tr>
                            <th class="w-25">Category</th>
                            <td dmx-text="data_viewCategory.data[0].name"></td>
                        </tr>
                        <tr>
                            <th>Name</th>
                            <td dmx-text="data_detailProduct.data.name"></td>
                        </tr>
                        <tr>
                            <th>Price</th>
                            <td dmx-text="data_detailProduct.data.price.formatCurrency('$', '.', ',', 2)"></td>
                        </tr>
                        <tr>
                            <th>Short description</th>
                            <td dmx-text="data_detailProduct.data.short_description"></td>
                        </tr>
                        <tr>
                            <th>Long description</th>
                            <td dmx-text="data_detailProduct.data.long_description"></td>
                        </tr>
                        <tr>
                            <th>Update date</th>
                            <td dmx-text="data_detailProduct.data.update_date"></td>
                        </tr>
                        <tr>
                            <th>Live</th>
                            <td dmx-text="(data_detailProduct.data.live == 1)?'Yes':'No'"></td>
                        </tr>
                        <tr>
                            <th>Featured</th>
                            <td dmx-text="(data_detailProduct.data.featured == 1)?'Yes':'No'"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modalAddProduct" is="dmx-bs5-modal" tabindex="-1" dmx-on:hide-bs-modal="serverconnectformAddProduct.reset()">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Product</h5>
                </div>
                <div class="modal-body">
                    <form is="dmx-serverconnect-form" id="serverconnectformAddProduct" method="post" action="/api/products/products/upsert" dmx-generator="bootstrap5" dmx-form-type="vertical" dmx-on:success="notifies1.success('The product has been added');serverconnectProducts.load({});modalAddProduct.hide()">
                        <div class="form-group mb-3">
                            <label for="inp_name">Name</label>
                            <input type="text" class="form-control" id="inp_name" name="name" aria-describedby="inp_name_help" placeholder="Enter Name">
                        </div>
                        <input type="hidden" name="category_id" id="inp_category_id" dmx-bind:value="searchCategory.value">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" dmx-on:click="serverconnectformAddProduct.submit()">Add Product</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modalUpdateProduct" is="dmx-bs5-modal" tabindex="-1">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modal title</h5>
                </div>
                <div class="modal-body">
                    <p>Modal body text goes here.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modalDeleteProduct" is="dmx-bs5-modal" tabindex="-1">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modal title</h5>
                </div>
                <div class="modal-body">
                    <p>Modal body text goes here.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>