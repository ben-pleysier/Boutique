<!-- Wappler include head-page="layouts/main" fontawesome_5="cdn" bootstrap5="local" is="dmx-app" id="checkout" appConnect="local" components="{dmxFormatter:{},dmxBootstrap5TableGenerator:{},dmxBootstrap5Modal:{},dmxValidator:{}}" -->
<dmx-serverconnect id="serverconnectSecretKey" url="/api/security/secretKey" noload="true"></dmx-serverconnect>
<dmx-value id="varTotal" dmx-bind:value="0"></dmx-value>
<div class="container">
    <div class="row">
        <div class="col">
            <h1>Checkout</h1>
        </div>
    </div>
    <div class="row" dmx-show="dsCart.data.isEmpty()">
        <div class="col">
            <p>Your Shopping Cart is empty!</p>
        </div>
    </div>
    <div class="row" dmx-hide="dsCart.data.isEmpty()">
        <div class="col">
            <p>So that we know who you are and where to send the goods</p>
            <p class="mb-0">If you are an existing customer, welcome back and please log in</p>
            <button id="btnLogIn" class="btn btn-primary w-100">Log In</button>
            <p class="mt-4 mb-0">If this is the first time purchase, welcome and please click on `New Customer`.</p>
            <button id="btnRegister" class="btn btn-primary w-100" data-bs-target="#modalRegister" data-bs-toggle="modal" dmx-on:click="serverconnectSecretKey.load({})">New Customer</button>
        </div>
        <div class="col">
            <div class="row">
                <div class="col">
                    <h2 class="h4">Order Summary</h2>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th class="visually-hidden">Header</th>
                                    <th>Name</th>
                                    <th class="text-center">Price</th>
                                    <th class="text-center">Qty</th>
                                    <th scope="row" class="text-end">Amount</th>
                                </tr>
                            </thead>
                            <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="dsCart.data" id="tableRepeatShoppingCartItems">
                                <tr dmx-hide="serverconnectProduct.data.queryFilteredProduct.name.isEmpty()">
                                    <td class="visually-hidden">
                                        <dmx-serverconnect id="serverconnectProduct" url="/api/products/products/filtered_on_id" dmx-param:filter="id"></dmx-serverconnect>
                                    </td>
                                    <td dmx-text="serverconnectProduct.data.queryFilteredProduct.name"></td>
                                    <td dmx-text="serverconnectProduct.data.queryFilteredProduct.price.toNumber().formatCurrency('$', '.', ',', 2)" class="text-center"></td>
                                    <td dmx-text="quantity" class="text-center"></td>
                                    <td class="text-end">
                                        <input id="amount" name="amount" type="hidden" class="form-control" dmx-bind:id="'amount+'+$index" dmx-bind:value="(quantity * serverconnectProduct.data.queryFilteredProduct.price)" dmx-on:updated="varTotal.setValue((varTotal.value + value.toNumber()))">
                                        <p dmx-text="amount.value.toNumber().formatCurrency('$', '.', ',', 2)">A nice paragraph</p>
                                    </td>
                                </tr>
                                <tr dmx-show="serverconnectProduct.data.queryFilteredProduct.name.isEmpty()">
                                    <td colspan="5">This product is no longer available</td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="5" class="text-end">{{'Total Payable '+varTotal.value.toNumber().formatCurrency('$', '.', ',', 2)}}</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <h4>Shipping Details</h4>
                    <p>Please Login</p>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalRegister" is="dmx-bs5-modal" tabindex="-1" dmx-on:hide-bs-modal="frmRegister.reset(true)">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Customer Registration</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form is="dmx-serverconnect-form" id="frmRegister" method="post" action="/api/customers/customers/upsert" dmx-generator="bootstrap5" dmx-form-type="vertical" dmx-on:success="modalRegister.hide();notifies.success('You have successfully registered.')" dmx-on:error="notifies.danger('Oops! An error has occurred. Please get in touch with us.')" dmx-on:unauthorized="notifies.danger('You are not authorised to register.')">
                    <div class="form-group mb-3">
                        <label for="ins_email">Email</label>
                        <input type="text" class="form-control" id="ins_email" name="email" aria-describedby="ins_email_help" placeholder="Enter Email" required="true" data-rule-email="true">
                    </div>
                    <div class="form-group mb-3">
                        <label for="ins_password">Password</label>
                        <input type="text" class="form-control" id="ins_password" name="password" aria-describedby="ins_password_help" placeholder="Enter Password" required="true">
                    </div>
                    <div class="form-group mb-3 d-none">
                        <label for="ins_title">Title</label>
                        <input type="text" class="form-control" id="ins_title" name="title" aria-describedby="ins_title_help" placeholder="Enter Title" required="true" dmx-bind:value="serverconnectSecretKey.data.myKey">
                    </div>
                    <div class="form-group mb-3">
                        <label for="ins_first_name">First Name</label>
                        <input type="text" class="form-control" id="ins_first_name" name="first_name" aria-describedby="ins_first_name_help" placeholder="Enter First Name" required="true">
                    </div>
                    <div class="form-group mb-3">
                        <label for="ins_last_name">Last Name</label>
                        <input type="text" class="form-control" id="ins_last_name" name="last_name" aria-describedby="ins_last_name_help" placeholder="Enter Last Name" required="true">
                    </div>
                    <div class="form-group mb-3 d-none">
                        <label for="ins_company">Company</label>
                        <input type="text" class="form-control" id="ins_company" name="company" aria-describedby="ins_company_help" placeholder="Enter Company">
                    </div>
                    <div class="form-group mb-3 d-none">
                        <label for="ins_position">Position</label>
                        <input type="text" class="form-control" id="ins_position" name="position" aria-describedby="ins_position_help" placeholder="Enter Position">
                    </div>
                    <div class="form-group mb-3">
                        <label for="ins_street">Street</label>
                        <input type="text" class="form-control" id="ins_street" name="street" aria-describedby="ins_street_help" placeholder="Enter Street" required="true">
                    </div>
                    <div class="form-group mb-3">
                        <label for="ins_city">City</label>
                        <input type="text" class="form-control" id="ins_city" name="city" aria-describedby="ins_city_help" placeholder="Enter City" required="true">
                    </div>
                    <div class="form-group mb-3">
                        <label for="ins_postcode">Postcode</label>
                        <input type="text" class="form-control" id="ins_postcode" name="postcode" aria-describedby="ins_postcode_help" placeholder="Enter Postcode" required="true">
                    </div>
                    <div class="form-group mb-3">
                        <label for="ins_country">Country</label>
                        <input type="text" class="form-control" id="ins_country" name="country" aria-describedby="ins_country_help" placeholder="Enter Country" required="true">
                    </div>
                    <div class="form-group mb-3">
                        <label for="ins_phone">Phone</label>
                        <input type="text" class="form-control" id="ins_phone" name="phone" aria-describedby="ins_phone_help" placeholder="Enter Phone">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" dmx-on:click="frmRegister.submit()">Register</button>
            </div>
        </div>
    </div>
</div>
<meta name="ac:route" content="/checkout">